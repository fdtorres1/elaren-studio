---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { readFile } from 'fs/promises';
import { parseMarkdown } from '../utils/markdown';
import { markdownToHtml } from '../utils/markdownToHtml';

const content = await readFile('./elaren_site_content/contact.md', 'utf-8');
const { frontmatter, body } = parseMarkdown(content);
const htmlContent = markdownToHtml(body);
---

<BaseLayout title={frontmatter.title} description={frontmatter.description}>
	<Header />
	<main>
		<section class="container py-16 md:py-24">
			<div class="max-w-2xl">
				<div class="prose mb-12" set:html={htmlContent} />
				
				<form
					action="https://api.web3forms.com/submit"
					method="POST"
					class="space-y-6"
					id="contact-form"
				>
					<input
						type="hidden"
						name="access_key"
						value="YOUR_WEB3FORMS_ACCESS_KEY"
					/>
					<input type="hidden" name="subject" value="New Contact Form Submission - Elaren Studio" />
					<input type="hidden" name="from_name" value="Elaren Studio Contact Form" />
					<input type="checkbox" name="botcheck" class="hidden" />

					<div>
						<label for="name" class="block text-sm font-medium text-ink mb-2">
							Name <span class="text-accent">*</span>
						</label>
						<input
							type="text"
							id="name"
							name="name"
							required
							class="w-full px-4 py-3 border border-slate-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"
						/>
					</div>

					<div>
						<label for="email" class="block text-sm font-medium text-ink mb-2">
							Email <span class="text-accent">*</span>
						</label>
						<input
							type="email"
							id="email"
							name="email"
							required
							class="w-full px-4 py-3 border border-slate-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"
						/>
					</div>

					<div>
						<label for="organization" class="block text-sm font-medium text-ink mb-2">
							Organization (optional)
						</label>
						<input
							type="text"
							id="organization"
							name="organization"
							class="w-full px-4 py-3 border border-slate-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"
						/>
					</div>

					<div>
						<label for="message" class="block text-sm font-medium text-ink mb-2">
							Message / Project Goals <span class="text-accent">*</span>
						</label>
						<textarea
							id="message"
							name="message"
							required
							rows="6"
							class="w-full px-4 py-3 border border-slate-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent resize-y"
						></textarea>
					</div>

					<button
						type="submit"
						class="px-6 py-3 bg-accent text-paper rounded-xl font-medium hover:opacity-90 hover:shadow-brand transition-all"
					>
						Send Message
					</button>
				</form>

				<div id="form-status" class="mt-6 hidden"></div>

				<div class="mt-12 pt-8 border-t border-slate-100">
					<p class="text-sm text-ink/70">
						For updates or quick support, email <a href="mailto:support@elarenstudio.com" class="text-accent hover:underline">support@elarenstudio.com</a>.
					</p>
				</div>
			</div>
		</section>
	</main>
	<Footer />

	<script>
		const form = document.getElementById('contact-form') as HTMLFormElement;
		const status = document.getElementById('form-status') as HTMLDivElement;

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			
			const formData = new FormData(form);
			const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
			const originalText = submitButton.textContent;
			
			submitButton.disabled = true;
			submitButton.textContent = 'Sending...';
			status.classList.add('hidden');

			try {
				const response = await fetch(form.action, {
					method: 'POST',
					body: formData,
				});

				const data = await response.json();

				if (data.success) {
					status.className = 'mt-6 p-4 bg-green-50 border border-green-200 rounded-xl text-green-800';
					status.textContent = 'Thanksâ€”your message is in. We\'ll reply within one business day.';
					status.classList.remove('hidden');
					form.reset();
				} else {
					throw new Error(data.message || 'Something went wrong');
				}
			} catch (error) {
				status.className = 'mt-6 p-4 bg-red-50 border border-red-200 rounded-xl text-red-800';
				status.textContent = 'Sorry, there was an error sending your message. Please email us directly at support@elarenstudio.com';
				status.classList.remove('hidden');
			} finally {
				submitButton.disabled = false;
				submitButton.textContent = originalText;
			}
		});
	</script>
</BaseLayout>

