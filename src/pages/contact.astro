---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { readFile } from 'fs/promises';
import { parseMarkdown } from '../utils/markdown';
import { markdownToHtml } from '../utils/markdownToHtml';

const content = await readFile('./elaren_site_content/contact.md', 'utf-8');
const { frontmatter, body } = parseMarkdown(content);
// Remove the # heading from markdown since we'll render it in hero
const bodyWithoutHeading = body.replace(/^# .+\s*\n\n?/, '');
const htmlContent = markdownToHtml(bodyWithoutHeading);
---

<BaseLayout title={frontmatter.title} description={frontmatter.description}>
	<Header />
	<main>
		<!-- Hero -->
		<section class="container pt-16 md:pt-24 pb-4 md:pb-6">
			<div class="max-w-2xl">
				<p class="text-sm font-medium text-accent uppercase tracking-wider mb-3">Contact</p>
				<h1 class="text-4xl md:text-5xl font-semibold mb-6 text-ink">Let's build something enduring.</h1>
			</div>
		</section>

		<!-- Intro Content -->
		<section class="container pt-1 md:pt-2 pb-0">
			<div class="max-w-2xl">
				<div class="prose prose-lg mb-12" set:html={htmlContent} />
			</div>
		</section>

		<!-- Form Section -->
		<section class="relative pt-4 md:pt-6 pb-10 md:pb-12 overflow-hidden" style="background-color: #eef2f6;">
			<!-- Decorative gradient elements -->
			<div class="absolute top-0 right-0 w-96 h-96 bg-slate-300/25 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>
			<div class="absolute bottom-0 left-0 w-80 h-80 bg-slate-300/20 rounded-full blur-3xl translate-y-1/2 -translate-x-1/2 pointer-events-none"></div>
			<div class="absolute top-1/2 left-1/4 w-72 h-72 bg-slate-300/15 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 pointer-events-none"></div>
			
			<div class="container relative z-10">
				<div class="max-w-2xl">
				
				<form
					action="https://formsubmit.co/hello@elarenstudio.com"
					method="POST"
					class="space-y-3"
					id="contact-form"
				>
					<input type="hidden" name="_subject" value="New Contact Form Submission - Elaren Studio" />
					<input type="hidden" name="_next" value="" />
					<input type="hidden" name="_captcha" value="false" />
					<input type="hidden" name="_template" value="box" />

					<div>
						<label for="name" class="block text-sm font-medium text-ink mb-1.5">
							Name <span class="text-accent">*</span>
						</label>
						<input
							type="text"
							id="name"
							name="name"
							required
							class="w-full px-3 py-2.5 text-sm bg-paper border-2 border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all shadow-sm hover:shadow-md"
						/>
					</div>

					<div>
						<label for="email" class="block text-sm font-medium text-ink mb-1.5">
							Email <span class="text-accent">*</span>
						</label>
						<input
							type="email"
							id="email"
							name="email"
							required
							class="w-full px-3 py-2.5 text-sm bg-paper border-2 border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all shadow-sm hover:shadow-md"
						/>
					</div>

					<div>
						<label for="organization" class="block text-sm font-medium text-ink mb-1.5">
							Organization (optional)
						</label>
						<input
							type="text"
							id="organization"
							name="organization"
							class="w-full px-3 py-2.5 text-sm bg-paper border-2 border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all shadow-sm hover:shadow-md"
						/>
					</div>

					<div>
						<label for="message" class="block text-sm font-medium text-ink mb-1.5">
							Message / Project Goals <span class="text-accent">*</span>
						</label>
						<textarea
							id="message"
							name="message"
							required
							rows="5"
							class="w-full px-3 py-2.5 text-sm bg-paper border-2 border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-accent focus:border-accent transition-all shadow-sm hover:shadow-md resize-y"
						></textarea>
					</div>

					<button
						type="submit"
						class="px-8 py-4 bg-accent text-paper rounded-xl font-semibold no-underline shadow-xl shadow-accent/40 hover:shadow-2xl hover:shadow-accent/50 hover:-translate-y-0.5 transition-all duration-200"
					>
						Send Message
					</button>

					<div id="form-status" class="mt-6 hidden"></div>
				</form>
				</div>
			</div>
		</section>
	</main>
	<Footer />

	<script>
		const form = document.getElementById('contact-form') as HTMLFormElement;
		const status = document.getElementById('form-status') as HTMLDivElement;
		const nextInput = form.querySelector('input[name="_next"]') as HTMLInputElement;

		// Set the redirect URL to current page with success parameter
		if (nextInput) {
			nextInput.value = window.location.origin + window.location.pathname + '?success=true';
		}

		// Check for success parameter in URL
		const urlParams = new URLSearchParams(window.location.search);
		if (urlParams.get('success') === 'true') {
			status.className = 'mt-6 p-4 bg-green-50 border border-green-200 rounded-xl text-green-800';
			status.textContent = 'Thanksâ€”your message is in. We\'ll reply within one business day.';
			status.classList.remove('hidden');
			// Clean up URL
			window.history.replaceState({}, document.title, window.location.pathname);
		}

		form.addEventListener('submit', (e) => {
			const submitButton = form.querySelector('button[type="submit"]') as HTMLButtonElement;
			submitButton.disabled = true;
			submitButton.textContent = 'Sending...';
			status.classList.add('hidden');
			// Form will submit normally to FormSubmit
		});
	</script>
</BaseLayout>

